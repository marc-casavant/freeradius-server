#
# IMPORTANT:
#
# The following radius module config file MUST contain configurations of
# server names, if names are used, that can be resolved by DNS at runtime.
#
# This is especially important if this file is used by multiple environment configurations
# for testing.  If for example one of the udp { ipaddr = <server-name> } isn't available at runtime
# rlm_radius will throw an error and the FR server will not be able to complete the initialization phase
# and fail to run.
#

radius radius-module-homeserver1 {
	mode = proxy
	transport = udp
	type = Access-Request
	require_message_authenticator = auto
	response_window = 15
	zombie_period = 10
	revive_interval = 3600
	status_check {
		type = Status-Server
		update {
			User-Name := "test-user"
			NAS-Identifier := "Status check.  Are you alive?"
			Event-Timestamp = 0
		}
	}
	file {
	     filename = ${logdir}/packets.bin
	}
	udp {
		ipaddr = homeserver1
		port = 1812
		secret = testing123
	}
	pool {
		start = 0
		min = 1
		max = 8
		connecting = 1
		uses = 0
		lifetime = 0
		open_delay = 0.2
		close_delay = 1.0
		manage_interval = 0.2
		connection {
			connection_timeout = 3.0
			reconnect_delay = 5
		}
		request {
			per_connection_max = 255
			per_connection_target = 255
			free_delay = 10
		}
	}
	Access-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 2
		max_rtx_duration = 30
	}
	Accounting-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	CoA-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Disconnect-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Status-Server {
		initial_rtx_time = 2
		max_rtx_time = 5
		max_rtx_count = 5
		max_rtx_duration = 30
	}
}

radius radius-module-homeserver2 {
	mode = proxy
	transport = udp
	type = Access-Request
	require_message_authenticator = auto
	response_window = 15
	zombie_period = 10
	revive_interval = 3600
	status_check {
		type = Status-Server
		update {
			User-Name := "test-user"
			NAS-Identifier := "Status check.  Are you alive?"
			Event-Timestamp = 0
		}
	}
	file {
	     filename = ${logdir}/packets.bin
	}
	udp {
		ipaddr = homeserver2
		port = 1812
		secret = testing123
	}
	pool {
		start = 0
		min = 1
		max = 8
		connecting = 1
		uses = 0
		lifetime = 0
		open_delay = 0.2
		close_delay = 1.0
		manage_interval = 0.2
		connection {
			connection_timeout = 3.0
			reconnect_delay = 5
		}
		request {
			per_connection_max = 255
			per_connection_target = 255
			free_delay = 10
		}
	}
	Access-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 2
		max_rtx_duration = 30
	}
	Accounting-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	CoA-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Disconnect-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Status-Server {
		initial_rtx_time = 2
		max_rtx_time = 5
		max_rtx_count = 5
		max_rtx_duration = 30
	}
}

radius radius-module-homeserver1-acct {
	mode = proxy
	transport = udp
	type = Accounting-Request
	require_message_authenticator = auto
	response_window = 15
	zombie_period = 10
	revive_interval = 3600
	status_check {
		type = Status-Server
		update {
			User-Name := "test-user"
			NAS-Identifier := "Status check.  Are you alive?"
			Event-Timestamp = 0
		}
	}
	file {
	     filename = ${logdir}/packets.bin
	}
	udp {
		ipaddr = homeserver1
		port = 1813
		secret = testing123
	}
	pool {
		start = 0
		min = 1
		max = 8
		connecting = 1
		uses = 0
		lifetime = 0
		open_delay = 0.2
		close_delay = 1.0
		manage_interval = 0.2
		connection {
			connection_timeout = 3.0
			reconnect_delay = 5
		}
		request {
			per_connection_max = 255
			per_connection_target = 255
			free_delay = 10
		}
	}
	Access-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 2
		max_rtx_duration = 30
	}
	Accounting-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	CoA-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Disconnect-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Status-Server {
		initial_rtx_time = 2
		max_rtx_time = 5
		max_rtx_count = 5
		max_rtx_duration = 30
	}
}

radius radius-module-homeserver2-acct {
	mode = proxy
	transport = udp
	type = Accounting-Request
	require_message_authenticator = auto
	response_window = 15
	zombie_period = 10
	revive_interval = 3600
	status_check {
		type = Status-Server
		update {
			User-Name := "test-user"
			NAS-Identifier := "Status check.  Are you alive?"
			Event-Timestamp = 0
		}
	}
	file {
	     filename = ${logdir}/packets.bin
	}
	udp {
		ipaddr = homeserver2
		port = 1813
		secret = testing123
	}
	pool {
		start = 0
		min = 1
		max = 8
		connecting = 1
		uses = 0
		lifetime = 0
		open_delay = 0.2
		close_delay = 1.0
		manage_interval = 0.2
		connection {
			connection_timeout = 3.0
			reconnect_delay = 5
		}
		request {
			per_connection_max = 255
			per_connection_target = 255
			free_delay = 10
		}
	}
	Access-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 2
		max_rtx_duration = 30
	}
	Accounting-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	CoA-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Disconnect-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	Status-Server {
		initial_rtx_time = 2
		max_rtx_time = 5
		max_rtx_count = 5
		max_rtx_duration = 30
	}
}

#radius remoteradius1 {
#	transport = udp
#	mode = proxy
#	type = Access-Request
#	udp {
#		ipaddr = homeserver1
#		port = 1812
#		secret = testing123
#	}
#}
#
#radius remoteradius2 {
#	transport = udp
#	mode = proxy
#	type = Access-Request
#	udp {
#		ipaddr = homeserver2
#		port = 1812
#		secret = testing123
#	}
#}
#
#radius remoteradius1_acct {
#	transport = udp
#	mode = proxy
#	type = Accounting-Request
#	udp {
#		ipaddr = homeserver1
#		port = 1813
#		secret = testing123
#	}
#}
#
#radius remoteradius2_acct {
#	transport = udp
#	mode = proxy
#	type = Accounting-Request
#	udp {
#		ipaddr = homeserver2
#		port = 1813
#		secret = testing123
#	}
#}

radius replicate {
	type = Accounting-Request
	mode = unconnected-replicate
	transport = udp
	udp {
		src_ipaddr = *
	}
}

radius proxy {
	type = Access-Request
	mode = dynamic-proxy
	transport = udp
	udp {
		src_ipaddr = *
		src_port_start = 10000
		src_port_end = 11000
	}
	home_server_lifetime = 3600
	response_window = 15
	zombie_period = 10
	revive_interval = 3600
	Access-Request {
		initial_rtx_time = 2
		max_rtx_time = 16
		max_rtx_count = 5
		max_rtx_duration = 30
	}
	pool {
		start = 0
		min = 1
		max = 8
		connecting = 1
		uses = 0
		lifetime = 0
		open_delay = 0.2
		close_delay = 1.0
		manage_interval = 0.2
		connection {
			connection_timeout = 3.0
			reconnect_delay = 5
		}
		request {
			per_connection_max = 255
			per_connection_target = 255
			free_delay = 10
		}
	}
}

@policy proxy {
	subrequest {
		request := parent.request
		proxy
		parent.reply := reply
	}
}
